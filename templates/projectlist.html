<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    {% include 'header.html' %}
    <style>
        .col-md-8 {
            margin-left: 260px;

        }

        .card.mb-4 {
            margin-left: 260px;
        }

        .fontsz {
            font-size: 16px;
        }

        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            margin: 0 auto;
            top: 0%;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
        }
        
        .modal-content {
            left: 45%;
            top: 45%;
            background-color: #fff; /* White background for modal content */
            padding: 20px;
            border-radius: 10px; /* Rounded corners */
            width: 400px; /* Fixed width */
            text-align: center; /* Centered text */
        }
        
        #selectUser {
            margin: 5px; /* Margin around modal */
        }
        
        .modal input {
            width: 90%; /* Width of input field */
            padding: 5px; /* Padding inside input */
            margin-top: 10px; /* Space above input */
        }
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown btn{
            max-width: 300px;
        }
        
        .dropdown-menu {
            display: none; /* Hidden by default */
            position: absolute;
            background-color: white; /* White background for the dropdown */
            min-width: 160px; /* Minimum width for the dropdown */
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); /* Shadow effect */
            z-index: 1; /* Ensure dropdown appears on top */
            border-radius: 5px; /* Rounded corners */
        }
        
        .dropdown-menu label {
            padding: 10px; /* Padding for the checkboxes */
            cursor: pointer; /* Pointer cursor on hover */
        }
        
        .dropdown-menu label:hover {
            background-color: #f1f1f1; /* Background color on hover */
        }
        
        .dropdown.show .dropdown-menu {
            display: block; /* Show the dropdown when toggled */
        }
        @media (max-width: 1350px) {
           
            .min-height-300{
              min-height:200px !important;
        
            }
        }
        
    </style>
</head>

<body class="g-sidenav-show   bg-gray-100">
    <div class="min-height-300 bg-primary position-absolute w-100" style="margin:0px"></div>

    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <div class="card mb-4">
                    <div class="card-header pb-0">
                        <h6 class="fontsz">Project List</h6>
                    </div>
                    <div class="card-body px-0 pt-0 pb-2">
                        <div class="table-responsive p-0">
                            <table class="table align-items-center mb-0">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th
                                            class="text-uppercase text-secondary text-sm font-weight-bolder opacity-7 ps-2">
                                            Sl.No</th>
                                        <th
                                            class="text-uppercase text-secondary text-sm font-weight-bolder opacity-7 ps-2">
                                            Project Name</th>
                                        <th
                                            class="text-uppercase text-secondary text-sm font-weight-bolder opacity-7 ps-2">
                                            Description</th>
                                        <th
                                            class="text-uppercase text-secondary text-sm font-weight-bolder opacity-7 ps-2">
                                            Start Date</th>
                                        <!--<th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">Status</th>-->
                                        <th
                                            class="text-uppercase text-secondary text-sm font-weight-bolder opacity-7 ps-2">
                                            End Date</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    {% for pro in project %}
                                    <tr>
                                        <td><button type="button" class="btn btn-primary"
                                                onclick="allocateUser('{{ pro[0] }}')">Allocate User</button></td>
                                        <td class="justify-content-center ">{{ loop.index }}</td>
                                        <td>
                                            <div class="d-flex flex-column justify-content-center">
                                                <p class="thick">{{ pro[1] }}</p>
                                                <!-- Assuming you have email field in your user data -->

                                            </div>
                                        </td>

                                        <td class="justify-content-center">{{ pro[2] }}</td>
                                        <td class="justify-content-center">{{ pro[3] }}</td>
                                        <td class="justify-content-center">{{ pro[4] }}</td>

                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="selectUser" class="modal">
            <div class="modal-content">
                <label class="form-label" for="checkReason">Select Users for project:</label>
                
                <div class="dropdown">
                    <select name="username" id="project" class="form-control">
                        <option id="clr" value="select Employee">Select Employee</option>
                        {% for user in users %}
                        <option id="clr" value="{{ user[1] }}">{{ user[1] }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
        
                <div style="padding: 5px;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmAllocation()">Confirm</button>
                </div>
            </div>
        </div>
        

    </div>
    </main>

    <!--   Core JS Files   -->
    <script src="static/assets/js/core/popper.min.js"></script>
    <script src="static/assets/js/core/bootstrap.min.js"></script>
    <script src="static/assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="static/assets/js/plugins/smooth-scrollbar.min.js"></script>
    <script>
        var win = navigator.platform.indexOf('Win') > -1;
        if (win && document.querySelector('#sidenav-scrollbar')) {
            var options = {
                damping: '0.5'
            }
            Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        }
    </script>
    <!-- Github buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="static/assets/js/argon-dashboard.min.js?v=2.0.4"></script>
    <script>
        // Function to open modal and load users dynamically
        function allocateUser(projectId) {
            // Show the modal
            document.getElementById('selectUser').style.display = 'block';

            // Make an AJAX call to fetch the user list from the server
            fetch('/get_users')
                .then(response => response.json())
                .then(data => {
                    const userSelect = document.getElementById('userSelect');
                    userSelect.innerHTML = '';  // Clear previous options

                    // Populate the dropdown with users
                    data.users.forEach(user => {
                        const option = document.createElement('option');
                        option.value = user.id;
                        option.textContent = user.name;
                        userSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching users:', error);
                });
        }

        // Function to close modal
        function closeModal() {
            document.getElementById('selectUser').style.display = 'none';
        }

        // Function to confirm allocation (you can send selected user and project ID to backend)
        function confirmAllocation() {
            const selectedUserId = document.getElementById('userSelect').value;

            // Assuming you'll send the selected user and project ID to the backend
            // Perform another AJAX call or form submission to allocate the user to the project

            alert('User allocated successfully!');

            // Close the modal after confirming
            closeModal();
        }
        function toggleDropdown() {
            const dropdownMenu = document.getElementById('dropdownMenu');
            dropdownMenu.classList.toggle('show');
        }
        
        // Close the dropdown if the user clicks outside of it
        window.onclick = function(event) {
            if (!event.target.matches('.dropdown-toggle')) {
                const dropdowns = document.getElementsByClassName('dropdown-menu');
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
        
        function confirmAllocation() {
            const checkboxes = document.querySelectorAll('#dropdownMenu input[type="checkbox"]');
            const selectedUsers = [];
            checkboxes.forEach((checkbox) => {
                if (checkbox.checked) {
                    selectedUsers.push(checkbox.value);
                }
            });
            console.log('Selected users:', selectedUsers);
            closeModal(); // Close the modal after confirming
        }
        

    </script>
</body>

</html>